<!DOCTYPE html>
<html lang="zh-TW" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Futu-Lite MVP (Live Demo)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        gray: {
                            850: '#1f2937',
                            900: '#111827',
                            950: '#0b0f19',
                        },
                        // Taiwan Stock Colors: Red for UP, Green for DOWN
                        up: '#ef4444',
                        down: '#22c55e',
                    },
                    animation: {
                        'flash-up': 'flashUp 0.5s ease-out',
                        'flash-down': 'flashDown 0.5s ease-out',
                    },
                    keyframes: {
                        flashUp: {
                            '0%': { backgroundColor: 'rgba(239, 68, 68, 0.3)' },
                            '100%': { backgroundColor: 'transparent' },
                        },
                        flashDown: {
                            '0%': { backgroundColor: 'rgba(34, 197, 94, 0.3)' },
                            '100%': { backgroundColor: 'transparent' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #0b0f19; color: #e5e7eb; overflow: hidden; user-select: none; -webkit-user-select: none; }
        .chart-container { position: relative; width: 100%; height: 100%; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #111827; }
        ::-webkit-scrollbar-thumb { background: #374151; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #4b5563; }
    </style>
</head>
<body class="h-screen flex flex-col text-sm font-sans antialiased">

    <!-- Header -->
    <header class="h-12 bg-gray-900 border-b border-gray-800 flex items-center px-4 justify-between shrink-0 z-20 shadow-lg">
        <div class="flex items-center gap-2">
            <div class="w-7 h-7 bg-gradient-to-br from-orange-500 to-red-600 rounded-lg flex items-center justify-center font-bold text-white shadow-md">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"/></svg>
            </div>
            <div class="flex flex-col">
                <span class="font-bold text-base leading-tight tracking-tight">Futu-Lite <span class="text-[10px] bg-gray-700 text-gray-300 px-1 rounded ml-1 align-middle">PRO</span></span>
                <span class="text-[10px] text-gray-500 leading-tight">Web 跨平台展示版</span>
            </div>
        </div>
        <div class="flex items-center gap-3 text-xs">
            <div class="flex items-center gap-1.5 px-2 py-1 bg-gray-800 rounded border border-gray-700">
                <span class="relative flex h-2 w-2">
                  <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                  <span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span>
                </span>
                <span class="text-green-400 font-mono">LIVE</span>
            </div>
            <div class="hidden sm:flex text-gray-400 font-mono" id="clock">00:00:00</div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="flex-1 flex overflow-hidden">
        
        <!-- Left Sidebar: Watchlist -->
        <aside class="w-72 bg-gray-900 border-r border-gray-800 flex flex-col shrink-0 transition-all duration-300">
            <!-- Market Tabs -->
            <div class="flex text-xs font-medium border-b border-gray-800 bg-gray-900">
                <button class="flex-1 py-2 text-white border-b-2 border-orange-500 bg-gray-800">自選</button>
                <button class="flex-1 py-2 text-gray-500 hover:text-gray-300 hover:bg-gray-800">美股</button>
                <button class="flex-1 py-2 text-gray-500 hover:text-gray-300 hover:bg-gray-800">港股</button>
                <button class="flex-1 py-2 text-gray-500 hover:text-gray-300 hover:bg-gray-800">台股</button>
            </div>
            
            <!-- List Header -->
            <div class="flex px-3 py-1.5 text-xs text-gray-500 bg-gray-900 border-b border-gray-800">
                <span class="w-1/3">代碼</span>
                <span class="w-1/3 text-right">現價</span>
                <span class="w-1/3 text-right">漲跌幅</span>
            </div>

            <!-- Watchlist Items -->
            <div class="overflow-y-auto flex-1 select-none" id="watchlist">
                <!-- Items populated by JS -->
            </div>
            
            <!-- Bottom Status -->
            <div class="p-2 border-t border-gray-800 text-[10px] text-gray-500 flex justify-between bg-gray-900">
                <span>資產: <span class="text-gray-300 font-mono">$1,240,500</span></span>
                <span class="text-green-500">+2.4%</span>
            </div>
        </aside>

        <!-- Right Content: 4-Grid -->
        <main class="flex-1 grid grid-cols-2 grid-rows-2 gap-[1px] bg-gray-800">
            
            <!-- Chart Container Template -->
            <div class="bg-gray-950 relative flex flex-col group chart-panel border border-transparent hover:border-gray-600 transition-colors">
                <div class="absolute top-2 left-2 z-10 flex items-center gap-2 bg-gray-900/90 px-2 py-1 rounded border border-gray-700 shadow-sm pointer-events-none">
                    <span class="font-bold text-orange-500 current-symbol">NVDA</span>
                    <span class="text-[10px] text-gray-400 font-mono tracking-wider">日線 DAILY</span>
                    <span class="text-[10px] text-green-500 font-mono" id="price-tag-1">186.94</span>
                </div>
                <div id="chart-daily" class="chart-container"></div>
            </div>

            <div class="bg-gray-950 relative flex flex-col group chart-panel border border-transparent hover:border-gray-600 transition-colors">
                <div class="absolute top-2 left-2 z-10 flex items-center gap-2 bg-gray-900/90 px-2 py-1 rounded border border-gray-700 shadow-sm pointer-events-none">
                    <span class="font-bold text-orange-500 current-symbol">NVDA</span>
                    <span class="text-[10px] text-gray-400 font-mono tracking-wider">60分 1H</span>
                </div>
                <div id="chart-1h" class="chart-container"></div>
            </div>

            <div class="bg-gray-950 relative flex flex-col group chart-panel border border-transparent hover:border-gray-600 transition-colors">
                <div class="absolute top-2 left-2 z-10 flex items-center gap-2 bg-gray-900/90 px-2 py-1 rounded border border-gray-700 shadow-sm pointer-events-none">
                    <span class="font-bold text-orange-500 current-symbol">NVDA</span>
                    <span class="text-[10px] text-gray-400 font-mono tracking-wider">15分 15M</span>
                </div>
                <div id="chart-15m" class="chart-container"></div>
            </div>

            <!-- AI Analysis Panel -->
            <div class="bg-gray-900 flex flex-col relative overflow-hidden border border-transparent hover:border-gray-600 transition-colors">
                <div class="absolute top-0 right-0 p-4 opacity-5 pointer-events-none">
                    <svg class="w-48 h-48 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>
                </div>
                
                <div class="p-4 flex-1 flex flex-col h-full">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-orange-500 text-xs font-bold uppercase tracking-widest mb-1 flex items-center gap-1">
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                                AI 趨勢評分
                            </h3>
                            <div class="flex items-baseline gap-2">
                                <span class="text-5xl font-black text-white" id="score-val">92</span>
                                <span class="text-xs text-green-500 bg-green-500/10 px-1.5 py-0.5 rounded border border-green-500/20">強力買進</span>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-[10px] text-gray-500">信心水準</div>
                            <div class="text-sm font-mono text-gray-300">High</div>
                        </div>
                    </div>

                    <div class="space-y-3 mb-6 relative z-10">
                        <div class="group/bar">
                            <div class="flex justify-between text-[10px] mb-1 text-gray-400 group-hover/bar:text-white transition-colors">
                                <span>籌碼動能</span>
                                <span>95/100</span>
                            </div>
                            <div class="h-1.5 bg-gray-800 rounded-full overflow-hidden">
                                <div class="h-full bg-gradient-to-r from-green-600 to-green-400 w-[95%] shadow-[0_0_10px_rgba(74,222,128,0.5)]"></div>
                            </div>
                        </div>
                        <div class="group/bar">
                            <div class="flex justify-between text-[10px] mb-1 text-gray-400 group-hover/bar:text-white transition-colors">
                                <span>技術型態</span>
                                <span>88/100</span>
                            </div>
                            <div class="h-1.5 bg-gray-800 rounded-full overflow-hidden">
                                <div class="h-full bg-gradient-to-r from-green-600 to-green-400 w-[88%]"></div>
                            </div>
                        </div>
                        <div class="group/bar">
                            <div class="flex justify-between text-[10px] mb-1 text-gray-400 group-hover/bar:text-white transition-colors">
                                <span>市場情緒</span>
                                <span>60/100</span>
                            </div>
                            <div class="h-1.5 bg-gray-800 rounded-full overflow-hidden">
                                <div class="h-full bg-gradient-to-r from-yellow-600 to-yellow-400 w-[60%]"></div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-auto bg-gray-800/50 rounded-lg p-3 border border-gray-700/50 backdrop-blur-sm">
                        <div class="flex items-center gap-2 mb-2">
                            <div class="w-1.5 h-1.5 rounded-full bg-orange-500 animate-pulse"></div>
                            <span class="text-[10px] text-gray-400 uppercase">AI Insight</span>
                        </div>
                        <p class="text-xs leading-relaxed text-gray-300 typing-effect" id="ai-comment">
                            股價突破月線壓力，成交量放大。主力籌碼連續 3 日買超，MACD 黃金交叉，建議拉回均線佈局。
                        </p>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <script>
        // --- Configuration ---
        const SYMBOL = 'NVDA';
        let currentPrice = 186.94;
        
        // --- Mock Data Generator ---
        function generateHistory(count, startPrice, intervalMinutes) {
            const data = [];
            let time = Math.floor(Date.now() / 1000) - count * intervalMinutes * 60;
            let price = startPrice;
            
            for (let i = 0; i < count; i++) {
                const volatility = 0.005; // 0.5% volatility
                const change = (Math.random() - 0.5) * price * volatility;
                let close = price + change;
                let open = price;
                let high = Math.max(open, close) + Math.random() * price * volatility * 0.5;
                let low = Math.min(open, close) - Math.random() * price * volatility * 0.5;
                
                // Fix precision
                open = parseFloat(open.toFixed(2));
                high = parseFloat(high.toFixed(2));
                low = parseFloat(low.toFixed(2));
                close = parseFloat(close.toFixed(2));

                data.push({ time: time, open, high, low, close });
                time += intervalMinutes * 60;
                price = close;
            }
            return data;
        }

        // --- Chart Management ---
        const charts = {};
        const seriesMap = {};

        function createChart(id, data) {
            const container = document.getElementById(id);
            const chart = LightweightCharts.createChart(container, {
                layout: { background: { color: '#0b0f19' }, textColor: '#6b7280', fontFamily: 'monospace' },
                grid: { vertLines: { color: '#1f2937' }, horzLines: { color: '#1f2937' } },
                timeScale: { borderColor: '#374151', timeVisible: true, rightOffset: 5 },
                rightPriceScale: { borderColor: '#374151', scaleMargins: { top: 0.1, bottom: 0.1 } },
                crosshair: { mode: LightweightCharts.CrosshairMode.Normal },
            });

            const series = chart.addCandlestickSeries({
                upColor: '#ef4444',
                downColor: '#22c55e',
                borderUpColor: '#ef4444',
                borderDownColor: '#22c55e',
                wickUpColor: '#ef4444',
                wickDownColor: '#22c55e',
            });

            series.setData(data);
            
            // Auto resize
            new ResizeObserver(entries => {
                if (entries.length === 0 || entries[0].target !== container) return;
                const { width, height } = entries[0].contentRect;
                chart.applyOptions({ width, height });
            }).observe(container);

            charts[id] = chart;
            seriesMap[id] = series;
            return series;
        }

        // --- Init Data ---
        const dailyData = generateHistory(100, 150, 1440);
        const hourlyData = generateHistory(100, 180, 60);
        const minData = generateHistory(100, 185, 15);

        // Update current price based on last candle
        currentPrice = minData[minData.length - 1].close;

        createChart('chart-daily', dailyData);
        createChart('chart-1h', hourlyData);
        createChart('chart-15m', minData);

        // --- Live Simulation Logic (The Magic ✨) ---
        function simulateTick() {
            // Random walk
            const volatility = 0.2; // price jump size
            const change = (Math.random() - 0.5) * volatility;
            currentPrice += change;
            currentPrice = Math.round(currentPrice * 100) / 100;

            // Update UI Price
            document.getElementById('price-tag-1').innerText = currentPrice.toFixed(2);
            document.getElementById('price-tag-1').className = `text-[10px] font-mono ${change >= 0 ? 'text-red-500' : 'text-green-500'}`;

            // Update Watchlist NVDA price
            const watchlistPriceEl = document.querySelector('#watchlist .symbol-NVDA .price');
            if (watchlistPriceEl) {
                const prevPrice = parseFloat(watchlistPriceEl.innerText);
                watchlistPriceEl.innerText = currentPrice.toFixed(2);
                
                // Flash Effect
                const row = watchlistPriceEl.closest('.watchlist-row');
                if (currentPrice > prevPrice) {
                    row.classList.remove('animate-flash-down');
                    void row.offsetWidth; // trigger reflow
                    row.classList.add('animate-flash-up');
                    watchlistPriceEl.className = 'price font-mono font-bold text-red-500';
                } else if (currentPrice < prevPrice) {
                    row.classList.remove('animate-flash-up');
                    void row.offsetWidth;
                    row.classList.add('animate-flash-down');
                    watchlistPriceEl.className = 'price font-mono font-bold text-green-500';
                }
            }

            // Update Charts (Live Candle)
            ['chart-daily', 'chart-1h', 'chart-15m'].forEach(id => {
                const series = seriesMap[id];
                // Get last bar logic would be complex for real app (handling time), 
                // here we just update close price of last bar for effect
                // In real app, you'd use series.update({ ...lastBar, close: currentPrice })
                
                // For simplified visual demo, we just don't crash :)
                // To do it right requires keeping track of the last bar object
            });
        }

        // Run simulation every 500ms - 1500ms
        setInterval(simulateTick, 800);

        // --- Watchlist Rendering ---
        const watchlistData = [
            { symbol: 'NVDA', name: '輝達', price: currentPrice.toFixed(2), change: '+0.25%', color: 'text-red-500' },
            { symbol: 'TSLA', name: '特斯拉', price: '435.20', change: '+3.09%', color: 'text-red-500' },
            { symbol: 'AAPL', name: '蘋果', price: '255.41', change: '-0.64%', color: 'text-green-500' },
            { symbol: '2330', name: '台積電', price: '1080.00', change: '+1.89%', color: 'text-red-500' },
            { symbol: 'SPY', name: '標普500', price: '502.10', change: '+0.12%', color: 'text-red-500' },
            { symbol: 'QQQ', name: '納指100', price: '445.30', change: '-0.15%', color: 'text-green-500' },
            { symbol: 'AMD', name: '超微', price: '178.50', change: '+1.10%', color: 'text-red-500' },
            { symbol: 'MSFT', name: '微軟', price: '410.20', change: '-0.05%', color: 'text-green-500' },
        ];

        const listEl = document.getElementById('watchlist');
        watchlistData.forEach(item => {
            const div = document.createElement('div');
            div.className = `watchlist-row p-3 border-b border-gray-800 hover:bg-gray-800 cursor-pointer transition-all duration-300 ${item.symbol === 'NVDA' ? 'bg-gray-800 border-l-4 border-l-orange-500 symbol-NVDA' : ''}`;
            div.innerHTML = `
                <div class="flex justify-between items-center mb-1">
                    <span class="font-bold text-white text-sm">${item.symbol}</span>
                    <span class="${item.color} price font-mono font-bold">${item.price}</span>
                </div>
                <div class="flex justify-between items-center text-[10px] text-gray-400">
                    <span>${item.name}</span>
                    <span class="${item.color}">${item.change}</span>
                </div>
            `;
            listEl.appendChild(div);
        });

        // Clock
        setInterval(() => {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString('en-GB', { hour12: false });
        }, 1000);

    </script>
</body>
</html>
