<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Futu-Lite MVP (Stable)</title>
    <!-- 本地載入圖表庫 -->
    <script src="lightweight-charts.js"></script>
    <style>
        /* Reset & Base */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { background-color: #0b0f19; color: #e5e7eb; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }
        
        /* Layout */
        header { height: 48px; background: #111827; border-bottom: 1px solid #1f2937; display: flex; align-items: center; justify-content: space-between; padding: 0 16px; flex-shrink: 0; }
        .logo { display: flex; align-items: center; gap: 8px; font-weight: bold; color: white; }
        .logo-icon { width: 24px; height: 24px; background: #f97316; border-radius: 4px; display: flex; align-items: center; justify-content: center; color: white; font-size: 14px; }
        .status { display: flex; align-items: center; gap: 6px; font-size: 12px; color: #22c55e; }
        .dot { width: 8px; height: 8px; background: #22c55e; border-radius: 50%; box-shadow: 0 0 5px #22c55e; }

        .main-container { flex: 1; display: flex; overflow: hidden; }
        
        /* Sidebar */
        aside { width: 260px; background: #111827; border-right: 1px solid #1f2937; display: flex; flex-direction: column; flex-shrink: 0; }
        .tabs { display: flex; border-bottom: 1px solid #1f2937; }
        .tab { flex: 1; padding: 10px; text-align: center; color: #6b7280; font-size: 12px; cursor: pointer; }
        .tab.active { color: white; border-bottom: 2px solid #f97316; background: #1f2937; }
        
        .watchlist { flex: 1; overflow-y: auto; }
        .stock-row { padding: 12px; border-bottom: 1px solid #1f2937; display: flex; justify-content: space-between; cursor: pointer; transition: background 0.2s; }
        .stock-row:hover { background: #1f2937; }
        .stock-row.active { background: #1f2937; border-left: 4px solid #f97316; }
        .stock-info { display: flex; flex-direction: column; }
        .symbol { font-weight: bold; font-size: 14px; color: white; }
        .name { font-size: 12px; color: #9ca3af; }
        .price-box { text-align: right; }
        .price { font-family: monospace; font-size: 14px; font-weight: bold; }
        .change { font-size: 12px; }
        .text-up { color: #ef4444; }
        .text-down { color: #22c55e; }

        /* Grid System */
        main { flex: 1; display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; gap: 1px; background: #000; padding: 1px; }
        
        /* Chart Panel */
        .panel { background: #111827; position: relative; display: flex; flex-direction: column; overflow: hidden; }
        .panel-header { position: absolute; top: 8px; left: 8px; z-index: 10; display: flex; gap: 8px; }
        .badge { background: rgba(31, 41, 55, 0.9); border: 1px solid #374151; color: #f97316; padding: 2px 6px; border-radius: 4px; font-size: 11px; font-weight: bold; font-family: monospace; }
        .chart-div { width: 100%; height: 100%; }

        /* AI Score Panel */
        .ai-panel { padding: 20px; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; }
        .score { font-size: 72px; font-weight: 900; color: #22c55e; line-height: 1; margin: 10px 0; text-shadow: 0 0 20px rgba(34, 197, 94, 0.2); }
        .ai-title { color: #6b7280; font-size: 12px; letter-spacing: 1px; text-transform: uppercase; }
        .bar-container { width: 100%; max-width: 200px; margin-top: 10px; }
        .bar-row { display: flex; justify-content: space-between; font-size: 11px; color: #9ca3af; margin-bottom: 4px; }
        .progress-bg { height: 6px; background: #1f2937; border-radius: 3px; overflow: hidden; margin-bottom: 12px; }
        .progress-fill { height: 100%; background: #22c55e; }
        .progress-fill.yellow { background: #eab308; }

        /* Animation */
        @keyframes flashUp { 0% { background: rgba(239, 68, 68, 0.3); } 100% { background: transparent; } }
        @keyframes flashDown { 0% { background: rgba(34, 197, 94, 0.3); } 100% { background: transparent; } }
        .flash-up { animation: flashUp 0.5s; }
        .flash-down { animation: flashDown 0.5s; }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            aside { display: none; } /* Hide sidebar on mobile for now to focus on charts */
            main { grid-template-columns: 1fr; grid-template-rows: 1fr 1fr 1fr 1fr; }
        }
    </style>
</head>
<body>

    <header>
        <div class="logo">
            <div class="logo-icon">牛</div>
            <span>Futu-Lite <span style="font-weight:normal; color:#6b7280; font-size:12px;">v0.4 Stable</span></span>
        </div>
        <div class="status">
            <div class="dot"></div> LIVE
        </div>
    </header>

    <div class="main-container">
        <aside>
            <div class="tabs">
                <div class="tab active">自選</div>
                <div class="tab">美股</div>
                <div class="tab">港股</div>
            </div>
            <div class="watchlist" id="watchlist"></div>
        </aside>

        <main>
            <!-- Chart 1: Daily -->
            <div class="panel">
                <div class="panel-header">
                    <span class="badge">NVDA 日線</span>
                    <span class="badge" style="color:#facc15">MA20</span>
                </div>
                <div id="chart-daily" class="chart-div"></div>
            </div>

            <!-- Chart 2: 1H -->
            <div class="panel">
                <div class="panel-header"><span class="badge">NVDA 60分</span></div>
                <div id="chart-1h" class="chart-div"></div>
            </div>

            <!-- Chart 3: 15m -->
            <div class="panel">
                <div class="panel-header"><span class="badge">NVDA 15分</span></div>
                <div id="chart-15m" class="chart-div"></div>
            </div>

            <!-- AI Score -->
            <div class="panel ai-panel">
                <div class="ai-title">AI 趨勢評分</div>
                <div class="score">92</div>
                <div class="bar-container">
                    <div class="bar-row"><span>籌碼面</span><span class="text-down">強勢</span></div>
                    <div class="progress-bg"><div class="progress-fill" style="width: 95%"></div></div>
                    
                    <div class="bar-row"><span>技術面</span><span class="text-down">多頭</span></div>
                    <div class="progress-bg"><div class="progress-fill" style="width: 88%"></div></div>

                    <div class="bar-row"><span>市場情緒</span><span style="color:#eab308">中立</span></div>
                    <div class="progress-bg"><div class="progress-fill yellow" style="width: 60%"></div></div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Check if library loaded
        if (typeof LightweightCharts === 'undefined') {
            alert('圖表庫載入失敗！請檢查 lightweight-charts.js 是否存在');
        }

        function createChart(id, withVolume = false) {
            const container = document.getElementById(id);
            if (!container) return;

            const chart = LightweightCharts.createChart(container, {
                layout: { background: { color: '#111827' }, textColor: '#9ca3af' },
                grid: { vertLines: { color: '#1f2937' }, horzLines: { color: '#1f2937' } },
                timeScale: { borderColor: '#374151', timeVisible: true, rightOffset: 5 },
                rightPriceScale: { borderColor: '#374151' },
                crosshair: { mode: LightweightCharts.CrosshairMode.Normal },
            });

            const series = chart.addSeries(LightweightCharts.CandlestickSeries, {
                upColor: '#ef4444', downColor: '#22c55e',
                borderUpColor: '#ef4444', borderDownColor: '#22c55e',
                wickUpColor: '#ef4444', wickDownColor: '#22c55e',
            });

            // Data Gen
            let data = [];
            let volumeData = [];
            let maData = [];
            let time = Math.floor(Date.now()/1000) - 100*86400;
            let price = 150;

            for(let i=0; i<100; i++) {
                let open = price;
                let close = price * (1 + (Math.random()-0.5)*0.05);
                let high = Math.max(open, close) * 1.01;
                let low = Math.min(open, close) * 0.99;
                let vol = Math.random() * 10000 + 1000;
                
                data.push({ time: time + i*86400, open, high, low, close });
                if (withVolume) {
                    volumeData.push({ 
                        time: time + i*86400, 
                        value: vol, 
                        color: close >= open ? 'rgba(239, 68, 68, 0.5)' : 'rgba(34, 197, 94, 0.5)' 
                    });
                }

                // MA20
                if (i >= 20) {
                    let sum = 0;
                    for(let j=0; j<20; j++) sum += data[i-j].close;
                    maData.push({ time: time + i*86400, value: sum/20 });
                }
                price = close;
            }
            series.setData(data);

            // Add MA Line & Volume
            if (withVolume) {
                const maLine = chart.addSeries(LightweightCharts.LineSeries, { color: '#facc15', lineWidth: 1, priceLineVisible: false });
                maLine.setData(maData);
                
                const volumeSeries = chart.addSeries(LightweightCharts.HistogramSeries, {
                    priceFormat: { type: 'volume' },
                    priceScaleId: '', 
                    scaleMargins: { top: 0.8, bottom: 0 },
                });
                volumeSeries.setData(volumeData);
            }

            // Resize Observer
            new ResizeObserver(entries => {
                if (entries.length === 0 || entries[0].target !== container) return;
                const { width, height } = entries[0].contentRect;
                chart.applyOptions({ width, height });
            }).observe(container);

            return { series };
        }

        // Init
        createChart('chart-daily', true);
        createChart('chart-1h', false);
        createChart('chart-15m', false);

        // Watchlist
        const stocks = [
            { id: 'NVDA', name: '輝達', price: 186.94 },
            { id: 'TSLA', name: '特斯拉', price: 435.20 },
            { id: 'AAPL', name: '蘋果', price: 255.41 },
            { id: '2330', name: '台積電', price: 1080.00 },
        ];

        function renderList() {
            const el = document.getElementById('watchlist');
            if(!el) return;
            el.innerHTML = '';
            stocks.forEach(s => {
                const div = document.createElement('div');
                div.className = `stock-row ${s.id === 'NVDA' ? 'active' : ''}`;
                div.id = 'row-' + s.id;
                div.innerHTML = `
                    <div class="stock-info">
                        <span class="symbol">${s.id}</span>
                        <span class="name">${s.name}</span>
                    </div>
                    <div class="price-box">
                        <div class="price ${s.price > 100 ? 'text-up' : 'text-down'}" id="price-${s.id}">${s.price.toFixed(2)}</div>
                        <div class="change text-up">+0.5%</div>
                    </div>
                `;
                el.appendChild(div);
            });
        }
        renderList();

        // Simulate
        setInterval(() => {
            stocks.forEach(s => {
                const oldPrice = s.price;
                s.price += (Math.random() - 0.5) * 0.5;
                const priceEl = document.getElementById('price-' + s.id);
                const rowEl = document.getElementById('row-' + s.id);
                if(priceEl) {
                    priceEl.innerText = s.price.toFixed(2);
                    priceEl.className = `price ${s.price > oldPrice ? 'text-up' : 'text-down'}`;
                }
                if(rowEl) {
                    if(s.price > oldPrice) {
                        rowEl.classList.add('flash-up');
                        setTimeout(() => rowEl.classList.remove('flash-up'), 500);
                    } else {
                        rowEl.classList.add('flash-down');
                        setTimeout(() => rowEl.classList.remove('flash-down'), 500);
                    }
                }
            });
        }, 800);
    </script>
</body>
</html>
